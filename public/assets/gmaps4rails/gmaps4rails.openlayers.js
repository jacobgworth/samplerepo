(function(){var e=function(e,t){function n(){this.constructor=e}for(var a in t)r.call(t,a)&&(e[a]=t[a]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e},r={}.hasOwnProperty;this.Gmaps4RailsOpenlayers=function(r){function t(){t.__super__.constructor.apply(this,arguments),this.map_options={},this.mergeWithDefault("map_options"),this.markers_conf={},this.mergeWithDefault("markers_conf"),this.openMarkers=null,this.markersLayer=null,this.markersControl=null}return e(t,r),t.prototype.createPoint=function(){},t.prototype.createLatLng=function(e,r){return new OpenLayers.LonLat(r,e).transform(new OpenLayers.Projection("EPSG:4326"),new OpenLayers.Projection("EPSG:900913"))},t.prototype.createAnchor=function(e){return null===e?null:new OpenLayers.Pixel(e[0],e[1])},t.prototype.createSize=function(e,r){return new OpenLayers.Size(e,r)},t.prototype.createLatLngBounds=function(){return new OpenLayers.Bounds},t.prototype.createMap=function(){var e;return e=new OpenLayers.Map(this.map_options.id),e.addLayer(new OpenLayers.Layer.OSM),e.setCenter(this.createLatLng(this.map_options.center_latitude,this.map_options.center_longitude),this.map_options.zoom),e},t.prototype.createMarker=function(e){var r,t;return t=OpenLayers.Util.extend({},OpenLayers.Feature.Vector.style["default"]),t.fillOpacity=1,null===this.markersLayer&&(this.markersLayer=new OpenLayers.Layer.Vector("Markers",null),this.serviceObject.addLayer(this.markersLayer),this.markersLayer.events.register("featureselected",this.markersLayer,this.onFeatureSelect),this.markersLayer.events.register("featureunselected",this.markersLayer,this.onFeatureUnselect),this.markersControl=new OpenLayers.Control.SelectFeature(this.markersLayer),this.serviceObject.addControl(this.markersControl),this.markersControl.activate()),""===e.marker_picture?(t.graphicHeight=30,t.externalGraphic="http://openlayers.org/dev/img/marker-blue.png"):(t.graphicWidth=e.marker_width,t.graphicHeight=e.marker_height,t.externalGraphic=e.marker_picture,null!==e.marker_anchor&&(t.graphicXOffset=e.marker_anchor[0],t.graphicYOffset=e.marker_anchor[1]),""!==e.shadow_picture&&(t.backgroundGraphic=e.shadow_picture,t.backgroundWidth=e.shadow_width,t.backgroundHeight=e.shadow_height,null!==e.shadow_anchor&&(t.backgroundXOffset=e.shadow_anchor[0],t.backgroundYOffset=e.shadow_anchor[1]))),t.graphicTitle=e.title,r=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(e.Lng,e.Lat),null,t),r.geometry.transform(new OpenLayers.Projection("EPSG:4326"),new OpenLayers.Projection("EPSG:900913")),this.markersLayer.addFeatures([r]),r},t.prototype.clearMarkers=function(){return this.clearMarkersLayerIfExists(),this.markersLayer=null,this.boundsObject=new OpenLayers.Bounds},t.prototype.clearMarkersLayerIfExists=function(){return null!==this.markersLayer&&null!==this.serviceObject.getLayer(this.markersLayer.id)?this.serviceObject.removeLayer(this.markersLayer):void 0},t.prototype.extendBoundsWithMarkers=function(){var e,r,t,n,a;for(n=this.markers,a=[],r=0,t=n.length;t>r;r++)e=n[r],a.push(this.boundsObject.extend(this.createLatLng(e.lat,e.lng)));return a},t.prototype.createClusterer=function(e){var r,t,n,a,s;return n={pointRadius:"${radius}",fillColor:"#ffcc66",fillOpacity:.8,strokeColor:"#cc6633",strokeWidth:"${width}",strokeOpacity:.8},t={context:{width:function(e){var r;return null!=(r=e.cluster)?r:{2:1}},radius:function(e){var r;return r=2,e.cluster&&(r=Math.min(e.attributes.count,7)+2),r}}},s=new OpenLayers.Style(n,t),a=new OpenLayers.Strategy.Cluster,r=new OpenLayers.Layer.Vector("Clusters",{strategies:[a],styleMap:new OpenLayers.StyleMap({"default":s,select:{fillColor:"#8aeeef",strokeColor:"#32a8a9"}})}),this.clearMarkersLayerIfExists(),this.serviceObject.addLayer(r),r.addFeatures(e),r},t.prototype.clusterize=function(){var e,r,t,n,a;if(this.markers_conf.do_clustering===!0){for(null!==this.markerClusterer&&this.clearClusterer(),r=new Array,a=this.markers,t=0,n=a.length;n>t;t++)e=a[t],r.push(e.serviceObject);return this.markerClusterer=this.createClusterer(r)}},t.prototype.clearClusterer=function(){return this.serviceObject.removeLayer(this.markerClusterer)},t.prototype.createInfoWindow=function(e){return null!=e.description?e.serviceObject.infoWindow=e.description:void 0},t.prototype.onPopupClose=function(){return this.markersControl.unselect(this.feature)},t.prototype.onFeatureSelect=function(e){var r,t;return r=e.feature,t=new OpenLayers.Popup.FramedCloud("featurePopup",r.geometry.getBounds().getCenterLonLat(),new OpenLayers.Size(300,200),r.infoWindow,null,!0,this.onPopupClose),r.popup=t,t.feature=r,this.serviceObject.addPopup(t)},t.prototype.onFeatureUnselect=function(e){var r;return r=e.feature,r.popup?(this.serviceObject.removePopup(r.popup),r.popup.destroy(),r.popup=null):void 0},t.prototype.fitBounds=function(){return this.serviceObject.zoomToExtent(this.boundsObject,!0)},t.prototype.centerMapOnUser=function(){return this.serviceObject.setCenter(this.userLocation)},t}(Gmaps4Rails)}).call(this);